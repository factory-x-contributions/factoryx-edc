meta {
  name: CreateIssuerParticipant
  type: http
  seq: 1
}

post {
  url: {{ISSUER_ID_API}}/v1alpha/participants
  body: json
  auth: inherit
}

headers {
  x-api-key: YWRtaW4.adminKey
}

body:json {
  {
    "roles": [],
    "serviceEndpoints": [
      {
        "id": "Issuer-IssuerService", 
        "type": "IssuerService", 
        "serviceEndpoint": "http://local-issuer-service:13132/api/issuance/v1alpha/participants/ZGlkOndlYjpsb2NhbC1pc3N1ZXItc2VydmljZTpmeC1pc3N1ZXI="
      }
    ],
    "active": true,
    "participantId": "did:web:local-issuer-service:fx-issuer",
    "did": "did:web:local-issuer-service:fx-issuer",
    "key": {
      "keyId": "did:web:local-issuer-service:fx-issuer#key-1",
      "privateKeyAlias": "did:web:local-issuer-service:fx-issuer-alias",
      "keyGeneratorParams": {
        "algorithm": "EdDSA",
        "curve": "Ed25519"
      }
    }
  }
}

script:post-response {
  const apiKey = res.getBody().apiKey.trim();
  if (apiKey) {
    bru.setEnvVar("ISSUER_APIKEY", apiKey);
  }
}

settings {
  encodeUrl: true
  timeout: 0
}
