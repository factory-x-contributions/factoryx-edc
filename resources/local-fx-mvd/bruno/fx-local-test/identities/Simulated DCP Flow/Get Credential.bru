meta {
  name: Get Credential
  type: http
  seq: 3
}

post {
  url: {{CONSUMER_IDHUB_CREDS_API}}/v1/participants/ZGlkOndlYjpjb25zdW1lci1pZGh1Yjp1c2VyOmNvbnN1bWVy/presentations/query
  body: json
  auth: bearer
}

auth:bearer {
  token: {{prov_access_token}}
}

body:json {
  {
      "@context": [
        "https://w3id.org/tractusx-trust/v0.8",
        "https://identity.foundation/presentation-exchange/submission/v1"
      ],
      "type": "PresentationQueryMessage",
      "presentationDefinition": null,
      "scope": [
        "org.eclipse.tractusx.vc.type:MembershipCredential:read"
      ]
  }
}

body:form-urlencoded {
  grant_type: client_credentials
  client_secret: Q2OZTcpgK9k9kPWI
  client_id: did:web:local-user-idhub:fx:user:two
  audience: did:web:local-user-idhub:fx:user:one
  token: eyJraWQiOiJkaWQ6d2ViOmxvY2FsLXVzZXItaWRodWI6Zng6dXNlcjpvbmUja2V5MSIsImFsZyI6IkVkMjU1MTkifQ.eyJhdWQiOiJkaWQ6d2ViOmxvY2FsLXVzZXItaWRodWI6Zng6dXNlcjp0d28iLCJzdWIiOiJkaWQ6d2ViOmxvY2FsLXVzZXItaWRodWI6Zng6dXNlcjpvbmUiLCJuYmYiOjE3NjQwODAzNzksImlzcyI6ImRpZDp3ZWI6bG9jYWwtdXNlci1pZGh1YjpmeDp1c2VyOm9uZSIsImV4cCI6MTc2NDA4MDY3OSwiaWF0IjoxNzY0MDgwMzc5LCJqdGkiOiIxZjRmYzk4Yy01ZjNkLTQ2MDQtYjc1Yy1jZjA5OGZkMGRkMTEiLCJ0b2tlbiI6ImV5SnJhV1FpT2lKa2FXUTZkMlZpT214dlkyRnNMWFZ6WlhJdGFXUm9kV0k2Wm5nNmRYTmxjanB2Ym1VamEyVjVNU0lzSW1Gc1p5STZJa1ZrTWpVMU1Ua2lmUS5leUpoZFdRaU9pSmthV1E2ZDJWaU9teHZZMkZzTFhWelpYSXRhV1JvZFdJNlpuZzZkWE5sY2pwdmJtVWlMQ0p6ZFdJaU9pSmthV1E2ZDJWaU9teHZZMkZzTFhWelpYSXRhV1JvZFdJNlpuZzZkWE5sY2pwMGQyOGlMQ0p1WW1ZaU9qRTNOalF3T0RBek56a3NJbk5qYjNCbElqb2lVM1Z3WlhKVGNHVmphV0ZzUTNKbFpHVnVkR2xoYkRweVpXRmtJaXdpYVhOeklqb2laR2xrT25kbFlqcHNiMk5oYkMxMWMyVnlMV2xrYUhWaU9tWjRPblZ6WlhJNmIyNWxJaXdpWlhod0lqb3hOelkwTURnd05qYzVMQ0pwWVhRaU9qRTNOalF3T0RBek56a3NJbXAwYVNJNkltRmpZMlZ6YzNSdmEyVnVMVEkzTWpaaU1HWTRMVFExTVRNdE5HRTVNQzFoWXpoaUxXUXlPRGM1WVRCbVl6STVOaUo5LjNkXzNvejRlN1lncmM1V2JRazBHNVdDVGZPcDFZTkt1N2tpdWlZWnNNZ19JLWRkR2FpRWJSYkhDWFM5OTV2NW5KOXQyYmtpVGFxejZIVkd0cERUUkRBIn0.eVipFlg2ei5PzKRJBbczQj_ZiTUQ-hRkC7F7Gul4IqztI3yp5u35xxmfTfJbZ80uRfkikFW8XENLQ-Gpez2jBw
}

tests {
  const presentation = res.getBody().presentation;
  test("contains presentation", function(){
    const presentation = res.getBody().presentation;
    const isString = typeof(presentation) == "string";
    const success = isString && presentation.split(".").length == 3;
    expect(success == true);
  })
}

settings {
  encodeUrl: true
  timeout: 0
}
